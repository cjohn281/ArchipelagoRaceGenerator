<Window x:Class="RaceConfig.GUI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:RaceConfig.GUI.ViewModels"
        xmlns:conv="clr-namespace:RaceConfig.GUI.Converters"
        xmlns:core="clr-namespace:RaceConfig.Core.Templates;assembly=RaceConfig.Core"
        mc:Ignorable="d"
        Title="Archipelago Race Generator" Height="540" Width="840">
    <Window.DataContext>
        <vm:GameOptionsViewModel />
    </Window.DataContext>

    <Window.Resources>
        <conv:BoolStringConverter x:Key="BoolStringConverter"/>

        <!-- Default template for EnumWeighted & PassThrough (string selection) -->
        <DataTemplate DataType="{x:Type core:RandomizerOption}">
            <StackPanel Margin="0,6,0,6">
                <TextBlock Text="{Binding DisplayName}" FontWeight="SemiBold"/>
                <ComboBox Width="320"
                          ItemsSource="{Binding Weights.Keys}"
                          SelectedItem="{Binding SelectedValue, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
            </StackPanel>
        </DataTemplate>

        <!-- BooleanWeighted -> CheckBox -->
        <DataTemplate x:Key="BooleanTemplate" DataType="{x:Type core:RandomizerOption}">
            <StackPanel Margin="0,6,0,6" Orientation="Horizontal">
                <TextBlock Text="{Binding DisplayName}" FontWeight="SemiBold" Margin="0,0,8,0" VerticalAlignment="Center"/>
                <CheckBox Content="Enabled"
                          IsChecked="{Binding SelectedValue, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource BoolStringConverter}}"/>
            </StackPanel>
        </DataTemplate>

        <!-- NumericWeighted -->
        <DataTemplate x:Key="NumericTemplate" DataType="{x:Type core:RandomizerOption}">
            <StackPanel Margin="0,6,0,6">
                <TextBlock Text="{Binding DisplayName}" FontWeight="SemiBold"/>
                <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                    <Slider Width="320"
                            Minimum="{Binding Min}"
                            Maximum="{Binding Max}"
                            Value="{Binding SelectedNumber, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                            IsSnapToTickEnabled="True"/>
                    <TextBlock Text="{Binding SelectedNumber}" Margin="8,0,0,0" VerticalAlignment="Center"/>
                </StackPanel>
            </StackPanel>
        </DataTemplate>

        <!-- List -->
        <DataTemplate x:Key="ListTemplate" DataType="{x:Type core:RandomizerOption}">
            <StackPanel Margin="0,6,0,6">
                <TextBlock Text="{Binding DisplayName}" FontWeight="SemiBold"/>
                <ItemsControl ItemsSource="{Binding SelectedList}"/>
            </StackPanel>
        </DataTemplate>

        <!-- Dictionary -->
        <DataTemplate x:Key="DictTemplate" DataType="{x:Type core:RandomizerOption}">
            <StackPanel Margin="0,6,0,6">
                <TextBlock Text="{Binding DisplayName}" FontWeight="SemiBold"/>
                <ItemsControl ItemsSource="{Binding SelectedDictionary}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding Key}" Width="160"/>
                                <TextBlock Text="{Binding Value}"/>
                            </StackPanel>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>
        </DataTemplate>

        <!-- Template selection per OptionType -->
        <Style x:Key="OptionContainerStyle" TargetType="ContentPresenter">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Type}" Value="BooleanWeighted">
                    <Setter Property="ContentTemplate" Value="{StaticResource BooleanTemplate}"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Type}" Value="NumericWeighted">
                    <Setter Property="ContentTemplate" Value="{StaticResource NumericTemplate}"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Type}" Value="List">
                    <Setter Property="ContentTemplate" Value="{StaticResource ListTemplate}"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Type}" Value="Dictionary">
                    <Setter Property="ContentTemplate" Value="{StaticResource DictTemplate}"/>
                </DataTrigger>
                <!-- EnumWeighted & PassThrough fall back to the default DataTemplate -->
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Template picker -->
        <StackPanel Orientation="Horizontal">
            <TextBlock Text="Template:" VerticalAlignment="Center" Margin="0,0,8,0"/>
            <ComboBox Width="520"
                      ItemsSource="{Binding TemplateFiles}"
                      SelectedItem="{Binding SelectedTemplateFile, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                <ComboBox.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding}" ToolTip="{Binding}"/>
                    </DataTemplate>
                </ComboBox.ItemTemplate>
            </ComboBox>
        </StackPanel>

        <!-- Game + Player -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,8,0,8" VerticalAlignment="Center">
            <TextBlock Text="{Binding Template.GameName}" FontSize="16" FontWeight="Bold" Margin="0,0,16,0"/>
            <TextBlock Text="Player:" VerticalAlignment="Center" Margin="0,0,8,0"/>
            <TextBox Width="200" Text="{Binding PlayerName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
        </StackPanel>

        <!-- Dynamic options -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding Options}" ItemContainerStyle="{StaticResource OptionContainerStyle}"/>
        </ScrollViewer>

        <!-- Export -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="Export YAML" Padding="12,6" Command="{Binding ExportCommand}"/>
        </StackPanel>
    </Grid>
</Window>